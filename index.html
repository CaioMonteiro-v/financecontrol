<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>FinanceControl</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b1020;
  --panel:#101a36;
  --line:rgba(255,255,255,.08);
  --text:#fff;
  --muted:#aaa;
  --good:#29d17d;
  --bad:#ff4d6d;
  --accent:#6d7cff;
}
*{box-sizing:border-box;font-family:Inter}
body{margin:0;background:var(--bg);color:var(--text)}
.app{display:grid;grid-template-columns:220px 1fr;height:100vh}
aside{border-right:1px solid var(--line);padding:20px}
main{padding:20px;overflow:auto}

button,input,select{
  background:#0f1730;
  color:#fff;
  border:1px solid var(--line);
  border-radius:10px;
  padding:10px
}
button{cursor:pointer}

.nav button{width:100%;margin-bottom:8px;text-align:left}
.nav button.active{background:var(--accent)}

.cards{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:20px 0}
.card{background:var(--panel);padding:14px;border-radius:14px}
.label{color:var(--muted);font-size:13px}
.value{font-size:22px;font-weight:700}

.good{color:var(--good)}
.bad{color:var(--bad)}

table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid var(--line);font-size:13px}

.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center
}
.modalBox{
  background:#0f1730;padding:20px;border-radius:16px;width:100%;max-width:520px
}
.modalBox h3{margin-top:0}
.modalBox input,select{width:100%;margin-bottom:10px}
.actions{display:flex;justify-content:flex-end;gap:10px}
</style>
</head>

<body>
<div class="app">
<aside>
  <h2>FinanceControl</h2>
  <div class="nav">
    <button onclick="setView('dash')" class="active">Dashboard</button>
    <button onclick="setView('fatura')">Fatura</button>
    <button onclick="setView('lanc')">Lançamentos</button>
  </div>
</aside>

<main>
  <div id="dash" class="view"></div>
  <div id="fatura" class="view" style="display:none"></div>
  <div id="lanc" class="view" style="display:none"></div>
</main>
</div>

<div class="modal" id="modal">
  <div class="modalBox">
    <h3>Novo lançamento</h3>
    <select id="tipo">
      <option value="entrada">Entrada</option>
      <option value="saida">Saída</option>
      <option value="cartao">Cartão</option>
    </select>
    <select id="meio">
      <option>Dinheiro</option>
      <option>Pix</option>
      <option>Débito</option>
      <option>Crédito</option>
    </select>
    <input id="desc" placeholder="Descrição">
    <input id="valor" type="number" placeholder="Valor">
    <input id="parcelas" type="number" placeholder="Parcelas (cartão)">
    <input id="data" type="date">
    <div class="actions">
      <button onclick="closeModal()">Cancelar</button>
      <button onclick="saveTx()">Salvar</button>
    </div>
  </div>
</div>

<script>
const KEY='finance_control_final';
const load=()=>JSON.parse(localStorage.getItem(KEY))||{
  salario:3450,
  tx:[],
  cartao:[]
};
const save=()=>localStorage.setItem(KEY,JSON.stringify(state));
let state=load();
let view='dash';

function setView(v){
  view=v;
  document.querySelectorAll('.view').forEach(x=>x.style.display='none');
  document.getElementById(v).style.display='block';
  document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
  document.querySelector(`.nav button[onclick*="${v}"]`).classList.add('active');
  render();
}

function money(v){
  return v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
}

function openModal(){
  document.getElementById('modal').style.display='flex';
}
function closeModal(){
  document.getElementById('modal').style.display='none';
}

function saveTx(){
  const tipo=tipoEl.value;
  const meio=meioEl.value;
  const v=Number(valor.value);
  const d=data.value;
  const ds=desc.value;
  const p=Number(parcelas.value||1);

  if(!v||!d||!ds){alert('Preencha tudo');return}

  if(tipo==='cartao'){
    const id=crypto.randomUUID();
    for(let i=0;i<p;i++){
      const dt=new Date(d);
      dt.setMonth(dt.getMonth()+i);
      state.cartao.push({
        id,desc:ds,valor:v/p,parcela:`${i+1}/${p}`,
        mes:`${dt.getFullYear()}-${dt.getMonth()+1}`
      });
    }
  }else{
    state.tx.push({tipo,meio,valor:v,data:d,desc:ds});
  }
  save();closeModal();render();
}

function render(){
  const entradas=state.tx.filter(t=>t.tipo==='entrada').reduce((a,b)=>a+b.valor,0);
  const saidas=state.tx.filter(t=>t.tipo==='saida').reduce((a,b)=>a+b.valor,0);
  const cart=state.cartao.reduce((a,b)=>a+b.valor,0);

  dash.innerHTML=`
    <button onclick="openModal()">+ Lançamento</button>
    <div class="cards">
      <div class="card"><div class="label">Saldo</div><div class="value">${money(state.salario+entradas-saidas)}</div></div>
      <div class="card"><div class="label">Entradas</div><div class="value good">${money(entradas)}</div></div>
      <div class="card"><div class="label">Saídas</div><div class="value bad">${money(saidas)}</div></div>
      <div class="card"><div class="label">Cartão</div><div class="value bad">${money(cart)}</div></div>
    </div>
  `;

  fatura.innerHTML=`
    <h2>Fatura do Cartão</h2>
    <table>
      <tr><th>Descrição</th><th>Parcela</th><th>Valor</th></tr>
      ${state.cartao.map(c=>`<tr><td>${c.desc}</td><td>${c.parcela}</td><td class="bad">${money(c.valor)}</td></tr>`).join('')}
    </table>
  `;

  lanc.innerHTML=`
    <h2>Lançamentos</h2>
    <table>
      <tr><th>Tipo</th><th>Meio</th><th>Descrição</th><th>Valor</th></tr>
      ${state.tx.map(t=>`<tr><td>${t.tipo}</td><td>${t.meio}</td><td>${t.desc}</td><td>${money(t.valor)}</td></tr>`).join('')}
    </table>
  `;
}

const tipoEl=document.getElementById('tipo');
const meioEl=document.getElementById('meio');
render();
</script>
</body>
</html>
